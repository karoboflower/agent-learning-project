# Go Agent API - åŸºç¡€ä½¿ç”¨ç¤ºä¾‹æ–‡æ¡£

> å®Œæ•´çš„ä¸­æ–‡å…¥é—¨æŒ‡å—ï¼šä»é›¶å¼€å§‹å­¦ä¹ ä»»åŠ¡é˜Ÿåˆ—å’Œè°ƒåº¦ç³»ç»Ÿ

---

## ğŸ“‹ ç›®å½•

1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [ç¤ºä¾‹æ¦‚è§ˆ](#ç¤ºä¾‹æ¦‚è§ˆ)
3. [è¯¦ç»†è¯´æ˜](#è¯¦ç»†è¯´æ˜)
4. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
5. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
7. [ä¸‹ä¸€æ­¥å­¦ä¹ ](#ä¸‹ä¸€æ­¥å­¦ä¹ )

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Go 1.23.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- macOS / Linux / Windows
- å·²å®‰è£…é¡¹ç›®ä¾èµ–

### è¿è¡Œç¤ºä¾‹

```bash
# æ–¹æ³• 1: ä»é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
cd /Users/wangchunhua/Desktop/work/project/agent-learning-project/projects/phase2-practice/go-agent-api
go run examples/basic-usage/main.go

# æ–¹æ³• 2: ä½¿ç”¨ Make å‘½ä»¤
make run-example

# æ–¹æ³• 3: ç¼–è¯‘åè¿è¡Œ
go build -o bin/example examples/basic-usage/main.go
./bin/example
```

### é¢„æœŸè¾“å‡º

è¿è¡Œç¤ºä¾‹åï¼Œæ‚¨å°†çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š

```
ğŸš€ Go Agent API - åŸºç¡€ä½¿ç”¨ç¤ºä¾‹
====================================================

ğŸ“‹ ç¤ºä¾‹ 1: ä»»åŠ¡é˜Ÿåˆ—åŸºç¡€æ“ä½œ
----------------------------------------------------
âœ“ åˆ›å»ºç©ºé˜Ÿåˆ—ï¼Œå½“å‰é•¿åº¦: 0

ğŸ“¥ æ·»åŠ ä»»åŠ¡åˆ°é˜Ÿåˆ—:
  â€¢ ä»»åŠ¡ task-1 å·²åŠ å…¥ (ä¼˜å…ˆçº§: 1)
  â€¢ ä»»åŠ¡ task-2 å·²åŠ å…¥ (ä¼˜å…ˆçº§: 10)
  â€¢ ä»»åŠ¡ task-3 å·²åŠ å…¥ (ä¼˜å…ˆçº§: 5)

âœ“ é˜Ÿåˆ—å½“å‰é•¿åº¦: 3

ğŸ” å †é¡¶ä»»åŠ¡ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰:
  ID: task-2
  è¾“å…¥: é«˜ä¼˜å…ˆçº§ä»»åŠ¡ - ä¼˜å…ˆçº§ 10
  ä¼˜å…ˆçº§: 10

ğŸ“¤ æŒ‰ä¼˜å…ˆçº§é¡ºåºå‡ºé˜Ÿ:
  1. [task-2] é«˜ä¼˜å…ˆçº§ä»»åŠ¡ - ä¼˜å…ˆçº§ 10 (ä¼˜å…ˆçº§: 10)
  2. [task-3] ä¸­ç­‰ä¼˜å…ˆçº§ä»»åŠ¡ - ä¼˜å…ˆçº§ 5 (ä¼˜å…ˆçº§: 5)
  3. [task-1] æ™®é€šä»»åŠ¡ - ä¼˜å…ˆçº§ 1 (ä¼˜å…ˆçº§: 1)

âœ“ é˜Ÿåˆ—å·²æ¸…ç©ºï¼Œå½“å‰é•¿åº¦: 0

ğŸ¯ ç¤ºä¾‹ 2: ä¼˜å…ˆçº§è°ƒåº¦æ¼”ç¤º
----------------------------------------------------
ğŸ“‹ ä»»åŠ¡åˆ—è¡¨ï¼ˆæäº¤é¡ºåºï¼‰:
1. [ä¼˜å…ˆçº§:10] urgent-bug - ç´§æ€¥ï¼šä¿®å¤ç”Ÿäº§ç¯å¢ƒ Bug
2. [ä¼˜å…ˆçº§: 7] code-review - ä»£ç å®¡æŸ¥ï¼šPR #123
3. [ä¼˜å…ˆçº§: 5] feature-dev - å¼€å‘æ–°åŠŸèƒ½ï¼šç”¨æˆ·ç®¡ç†
4. [ä¼˜å…ˆçº§: 3] routine-test - å¸¸è§„æµ‹è¯•ï¼šå›å½’æµ‹è¯•
5. [ä¼˜å…ˆçº§: 2] documentation - æ›´æ–°æ–‡æ¡£ï¼šAPI æ–‡æ¡£

ğŸ”„ æ‰§è¡Œé¡ºåºï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰:
1. [ä¼˜å…ˆçº§:10] urgent-bug - ç´§æ€¥ï¼šä¿®å¤ç”Ÿäº§ç¯å¢ƒ Bug
2. [ä¼˜å…ˆçº§: 7] code-review - ä»£ç å®¡æŸ¥ï¼šPR #123
3. [ä¼˜å…ˆçº§: 5] feature-dev - å¼€å‘æ–°åŠŸèƒ½ï¼šç”¨æˆ·ç®¡ç†
4. [ä¼˜å…ˆçº§: 3] routine-test - å¸¸è§„æµ‹è¯•ï¼šå›å½’æµ‹è¯•
5. [ä¼˜å…ˆçº§: 2] documentation - æ›´æ–°æ–‡æ¡£ï¼šAPI æ–‡æ¡£

ğŸ“Š ç¤ºä¾‹ 3: ä»»åŠ¡çŠ¶æ€ç®¡ç†
----------------------------------------------------
å¾…å¤„ç†ä»»åŠ¡æ•°é‡: 2
  â€¢ status-task-1: ä»»åŠ¡ 1
  â€¢ status-task-2: ä»»åŠ¡ 2

è¿è¡Œä¸­ä»»åŠ¡æ•°é‡: 1
  â€¢ status-task-3: ä»»åŠ¡ 3

ğŸ”„ æ›´æ–°ä»»åŠ¡çŠ¶æ€:
âœ“ ä»»åŠ¡ status-task-1 çŠ¶æ€å·²æ›´æ–°ä¸º Running

æ›´æ–°å:
  å¾…å¤„ç†ä»»åŠ¡: 1
  è¿è¡Œä¸­ä»»åŠ¡: 2

====================================================
âœ… æ‰€æœ‰ç¤ºä¾‹æ‰§è¡Œå®Œæˆï¼
====================================================

ğŸ“š å­¦åˆ°çš„çŸ¥è¯†ç‚¹:
1. âœ“ ä»»åŠ¡é˜Ÿåˆ—çš„åˆ›å»ºå’ŒåŸºæœ¬æ“ä½œ
2. âœ“ ä¼˜å…ˆçº§è°ƒåº¦æœºåˆ¶ï¼ˆé«˜ä¼˜å…ˆçº§ä¼˜å…ˆæ‰§è¡Œï¼‰
3. âœ“ ä»»åŠ¡çŠ¶æ€ç®¡ç†å’ŒæŸ¥è¯¢
4. âœ“ å †æ•°æ®ç»“æ„çš„å®é™…åº”ç”¨

ğŸ“ ä¸‹ä¸€æ­¥å»ºè®®:
â€¢ é˜…è¯»å®Œæ•´çš„è°ƒåº¦å™¨æ–‡æ¡£: docs/SCHEDULER-DEEP-DIVE.md
â€¢ è¿è¡Œå®Œæ•´çš„ API æœåŠ¡å™¨: go run cmd/server/main.go
â€¢ å°è¯• HTTP API è°ƒç”¨: curl http://localhost:8080/health
```

---

## ğŸ“– ç¤ºä¾‹æ¦‚è§ˆ

æœ¬ç¤ºä¾‹åŒ…å« **3 ä¸ªæ ¸å¿ƒæ¼”ç¤ºåœºæ™¯**ï¼Œæ¶µç›–äº†ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½ï¼š

| ç¤ºä¾‹ç¼–å· | åç§° | ä¸»è¦å†…å®¹ | å­¦ä¹ ç›®æ ‡ |
|---------|------|---------|---------|
| ç¤ºä¾‹ 1 | ä»»åŠ¡é˜Ÿåˆ—åŸºç¡€æ“ä½œ | åˆ›å»ºé˜Ÿåˆ—ã€å…¥é˜Ÿã€å‡ºé˜Ÿã€æŸ¥çœ‹å †é¡¶ | æŒæ¡é˜Ÿåˆ—çš„åŸºæœ¬ä½¿ç”¨ |
| ç¤ºä¾‹ 2 | ä¼˜å…ˆçº§è°ƒåº¦æ¼”ç¤º | æ¨¡æ‹ŸçœŸå®ä»»åŠ¡è°ƒåº¦åœºæ™¯ | ç†è§£ä¼˜å…ˆçº§æœºåˆ¶ |
| ç¤ºä¾‹ 3 | ä»»åŠ¡çŠ¶æ€ç®¡ç† | çŠ¶æ€æŸ¥è¯¢ã€çŠ¶æ€æ›´æ–° | å­¦ä¼šä»»åŠ¡çŠ¶æ€ç®¡ç† |

---

## ğŸ“š è¯¦ç»†è¯´æ˜

### ç¤ºä¾‹ 1: ä»»åŠ¡é˜Ÿåˆ—åŸºç¡€æ“ä½œ

#### åŠŸèƒ½è¯´æ˜

è¿™ä¸ªç¤ºä¾‹æ¼”ç¤ºäº†ä»»åŠ¡é˜Ÿåˆ—çš„åŸºæœ¬ä½¿ç”¨æµç¨‹ï¼š

1. **åˆ›å»ºä»»åŠ¡é˜Ÿåˆ—** - ä½¿ç”¨ `scheduler.NewTaskQueue()` åˆå§‹åŒ–
2. **åˆ›å»ºä»»åŠ¡å¯¹è±¡** - å®šä¹‰ä¸åŒä¼˜å…ˆçº§çš„ä»»åŠ¡
3. **å…¥é˜Ÿæ“ä½œ** - ä½¿ç”¨ `queue.Enqueue()` æ·»åŠ ä»»åŠ¡
4. **æŸ¥çœ‹å †é¡¶** - ä½¿ç”¨ `queue.Peek()` æŸ¥çœ‹æœ€é«˜ä¼˜å…ˆçº§ä»»åŠ¡
5. **å‡ºé˜Ÿæ“ä½œ** - ä½¿ç”¨ `queue.Dequeue()` æŒ‰ä¼˜å…ˆçº§å–å‡ºä»»åŠ¡

#### æ ¸å¿ƒä»£ç è§£æ

```go
// 1. åˆ›å»ºä»»åŠ¡é˜Ÿåˆ—
queue := scheduler.NewTaskQueue()
// å†…éƒ¨ï¼šåˆå§‹åŒ–å †æ•°æ®ç»“æ„ï¼Œè®¾ç½®è¯»å†™é”

// 2. åˆ›å»ºä»»åŠ¡
task := &agent.Task{
    ID:        "task-1",        // ä»»åŠ¡å”¯ä¸€æ ‡è¯†
    AgentID:   "agent-001",     // æ‰€å± Agent
    Type:      agent.TaskTypeQuery,  // ä»»åŠ¡ç±»å‹
    Input:     "æ™®é€šä»»åŠ¡",       // ä»»åŠ¡è¾“å…¥
    Status:    agent.TaskStatusPending,  // åˆå§‹çŠ¶æ€ï¼šå¾…å¤„ç†
    Priority:  1,               // ä¼˜å…ˆçº§ï¼ˆ1-10ï¼‰
    CreatedAt: time.Now(),      // åˆ›å»ºæ—¶é—´
    UpdatedAt: time.Now(),      // æ›´æ–°æ—¶é—´
}

// 3. å…¥é˜Ÿï¼ˆO(log n) æ—¶é—´å¤æ‚åº¦ï¼‰
queue.Enqueue(task)
// å†…éƒ¨æµç¨‹ï¼š
// - è·å–å†™é”
// - è°ƒç”¨ heap.Push() å°†ä»»åŠ¡æ·»åŠ åˆ°åˆ‡ç‰‡æœ«å°¾
// - å‘ä¸Šè°ƒæ•´å †ç»“æ„ï¼ˆup heapifyï¼‰
// - é‡Šæ”¾å†™é”

// 4. æŸ¥çœ‹å †é¡¶ï¼ˆO(1) æ—¶é—´å¤æ‚åº¦ï¼‰
topTask := queue.Peek()
// å†…éƒ¨æµç¨‹ï¼š
// - è·å–è¯»é”
// - è¿”å› tasks[0]ï¼ˆå †é¡¶å…ƒç´ ï¼‰
// - é‡Šæ”¾è¯»é”

// 5. å‡ºé˜Ÿï¼ˆO(log n) æ—¶é—´å¤æ‚åº¦ï¼‰
task = queue.Dequeue()
// å†…éƒ¨æµç¨‹ï¼š
// - è·å–å†™é”
// - è°ƒç”¨ heap.Pop() äº¤æ¢å †é¡¶å’Œæœ«å°¾å…ƒç´ 
// - å‘ä¸‹è°ƒæ•´å †ç»“æ„ï¼ˆdown heapifyï¼‰
// - ç§»é™¤æœ«å°¾å…ƒç´ 
// - é‡Šæ”¾å†™é”
```

#### å…³é”®å­¦ä¹ ç‚¹

âœ… **ä¼˜å…ˆçº§è§„åˆ™**
- æ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜
- `Priority=10` æ¯” `Priority=1` ä¼˜å…ˆæ‰§è¡Œ
- ç¬¦åˆç›´è§‰çš„ä¼˜å…ˆçº§å®šä¹‰

âœ… **æ—¶é—´å¤æ‚åº¦**
- å…¥é˜Ÿï¼šO(log n) - éœ€è¦å‘ä¸Šè°ƒæ•´å †
- å‡ºé˜Ÿï¼šO(log n) - éœ€è¦å‘ä¸‹è°ƒæ•´å †
- æŸ¥çœ‹å †é¡¶ï¼šO(1) - ç›´æ¥è®¿é—®æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ 
- è·å–é•¿åº¦ï¼šO(1) - è¿”å›åˆ‡ç‰‡é•¿åº¦

âœ… **å¹¶å‘å®‰å…¨**
- ä½¿ç”¨ `sync.RWMutex` è¯»å†™é”
- è¯»æ“ä½œï¼ˆPeek, Lenï¼‰å¯ä»¥å¹¶å‘
- å†™æ“ä½œï¼ˆEnqueue, Dequeueï¼‰ç‹¬å è®¿é—®

---

### ç¤ºä¾‹ 2: ä¼˜å…ˆçº§è°ƒåº¦æ¼”ç¤º

#### åŠŸèƒ½è¯´æ˜

è¿™ä¸ªç¤ºä¾‹æ¨¡æ‹Ÿäº†çœŸå®çš„è½¯ä»¶å¼€å‘ä»»åŠ¡è°ƒåº¦åœºæ™¯ï¼Œå±•ç¤ºäº†ä¼˜å…ˆçº§é˜Ÿåˆ—å¦‚ä½•æ™ºèƒ½åœ°å®‰æ’ä»»åŠ¡æ‰§è¡Œé¡ºåºã€‚

#### åœºæ™¯è®¾å®š

å‡è®¾ä¸€ä¸ªå¼€å‘å›¢é˜Ÿæœ‰ä»¥ä¸‹ä»»åŠ¡éœ€è¦å¤„ç†ï¼š

| ä»»åŠ¡ID | ä»»åŠ¡æè¿° | ä¼˜å…ˆçº§ | è¯´æ˜ |
|-------|---------|--------|------|
| `urgent-bug` | ç´§æ€¥ï¼šä¿®å¤ç”Ÿäº§ç¯å¢ƒ Bug | 10 | æœ€é«˜ä¼˜å…ˆçº§ï¼Œå½±å“ç”¨æˆ·ä½¿ç”¨ |
| `code-review` | ä»£ç å®¡æŸ¥ï¼šPR #123 | 7 | é«˜ä¼˜å…ˆçº§ï¼Œé˜»å¡å…¶ä»–å¼€å‘ |
| `feature-dev` | å¼€å‘æ–°åŠŸèƒ½ï¼šç”¨æˆ·ç®¡ç† | 5 | ä¸­ç­‰ä¼˜å…ˆçº§ï¼Œå¸¸è§„å¼€å‘ |
| `routine-test` | å¸¸è§„æµ‹è¯•ï¼šå›å½’æµ‹è¯• | 3 | ä½ä¼˜å…ˆçº§ï¼Œå®šæœŸæ‰§è¡Œ |
| `documentation` | æ›´æ–°æ–‡æ¡£ï¼šAPI æ–‡æ¡£ | 2 | æœ€ä½ä¼˜å…ˆçº§ï¼Œä¸ç´§æ€¥ |

#### æ‰§è¡Œæµç¨‹

```
æäº¤é¡ºåºï¼šBugä¿®å¤ â†’ ä»£ç å®¡æŸ¥ â†’ åŠŸèƒ½å¼€å‘ â†’ æµ‹è¯• â†’ æ–‡æ¡£
                â†“
          ä¼˜å…ˆçº§é˜Ÿåˆ—è‡ªåŠ¨æ’åº
                â†“
æ‰§è¡Œé¡ºåºï¼šBugä¿®å¤(10) â†’ ä»£ç å®¡æŸ¥(7) â†’ åŠŸèƒ½å¼€å‘(5) â†’ æµ‹è¯•(3) â†’ æ–‡æ¡£(2)
```

#### æ ¸å¿ƒä»£ç è§£æ

```go
// å®šä¹‰ä»»åŠ¡æ•°æ®
tasks := []struct {
    id       string
    input    string
    priority int
}{
    {"urgent-bug", "ç´§æ€¥ï¼šä¿®å¤ç”Ÿäº§ç¯å¢ƒ Bug", 10},
    {"code-review", "ä»£ç å®¡æŸ¥ï¼šPR #123", 7},
    // ... æ›´å¤šä»»åŠ¡
}

// æŒ‰æäº¤é¡ºåºæ·»åŠ åˆ°é˜Ÿåˆ—
for _, t := range tasks {
    task := &agent.Task{
        ID:       t.id,
        Priority: t.priority,
        Input:    t.input,
        // ...
    }
    queue.Enqueue(task)
}

// æŒ‰ä¼˜å…ˆçº§é¡ºåºæ‰§è¡Œ
for queue.Len() > 0 {
    task := queue.Dequeue()
    // å¤„ç†ä»»åŠ¡...
}
```

#### å…³é”®å­¦ä¹ ç‚¹

âœ… **å®é™…åº”ç”¨åœºæ™¯**
- ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ
- æ¶ˆæ¯é˜Ÿåˆ—
- äº‹ä»¶å¤„ç†
- èµ„æºåˆ†é…

âœ… **ä¼˜å…ˆçº§è®¾è®¡**
```go
const (
    PriorityUrgent   = 10  // ç´§æ€¥ä»»åŠ¡ï¼ˆç”Ÿäº§é—®é¢˜ï¼‰
    PriorityHigh     = 7-8 // é«˜ä¼˜å…ˆçº§ï¼ˆé‡è¦åŠŸèƒ½ï¼‰
    PriorityNormal   = 4-6 // æ­£å¸¸ä¼˜å…ˆçº§ï¼ˆå¸¸è§„å¼€å‘ï¼‰
    PriorityLow      = 2-3 // ä½ä¼˜å…ˆçº§ï¼ˆä¼˜åŒ–ã€é‡æ„ï¼‰
    PriorityMinimal  = 1   // æœ€ä½ä¼˜å…ˆçº§ï¼ˆæ–‡æ¡£ã€æ¸…ç†ï¼‰
)
```

---

### ç¤ºä¾‹ 3: ä»»åŠ¡çŠ¶æ€ç®¡ç†

#### åŠŸèƒ½è¯´æ˜

è¿™ä¸ªç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ç®¡ç†å’ŒæŸ¥è¯¢ä»»åŠ¡çš„ä¸åŒçŠ¶æ€ï¼Œè¿™å¯¹äºç›‘æ§å’Œè¿½è¸ªä»»åŠ¡æ‰§è¡Œéå¸¸é‡è¦ã€‚

#### ä»»åŠ¡çŠ¶æ€è¯´æ˜

Go Agent API å®šä¹‰äº†ä»¥ä¸‹ä»»åŠ¡çŠ¶æ€ï¼š

```go
const (
    TaskStatusPending   = "pending"    // å¾…å¤„ç†ï¼šä»»åŠ¡å·²åˆ›å»ºï¼Œç­‰å¾…æ‰§è¡Œ
    TaskStatusRunning   = "running"    // è¿è¡Œä¸­ï¼šä»»åŠ¡æ­£åœ¨æ‰§è¡Œ
    TaskStatusCompleted = "completed"  // å·²å®Œæˆï¼šä»»åŠ¡æˆåŠŸæ‰§è¡Œ
    TaskStatusFailed    = "failed"     // å¤±è´¥ï¼šä»»åŠ¡æ‰§è¡Œå‡ºé”™
    TaskStatusCancelled = "cancelled"  // å·²å–æ¶ˆï¼šä»»åŠ¡è¢«ç”¨æˆ·å–æ¶ˆ
)
```

#### çŠ¶æ€è½¬æ¢æµç¨‹

```
    [åˆ›å»º]
      â†“
   Pending (å¾…å¤„ç†)
      â†“
   Running (è¿è¡Œä¸­)
      â†“
      â”œâ”€â†’ Completed (æˆåŠŸ)
      â”œâ”€â†’ Failed (å¤±è´¥)
      â””â”€â†’ Cancelled (å–æ¶ˆ)
```

#### æ ¸å¿ƒä»£ç è§£æ

```go
// 1. æŒ‰çŠ¶æ€æŸ¥è¯¢ä»»åŠ¡
pendingTasks := queue.GetByStatus(agent.TaskStatusPending)
runningTasks := queue.GetByStatus(agent.TaskStatusRunning)

// å†…éƒ¨å®ç°ï¼š
// func (tq *TaskQueue) GetByStatus(status agent.TaskStatus) []*agent.Task {
//     tq.mu.RLock()
//     defer tq.mu.RUnlock()
//     
//     tasks := make([]*agent.Task, 0)
//     for _, task := range tq.tasks {
//         if task.Status == status {
//             tasks = append(tasks, task)
//         }
//     }
//     return tasks
// }

// 2. æ›´æ–°ä»»åŠ¡çŠ¶æ€
updated := queue.UpdateTaskStatus("task-1", agent.TaskStatusRunning)

// å†…éƒ¨å®ç°ï¼š
// func (tq *TaskQueue) UpdateTaskStatus(taskID string, status agent.TaskStatus) bool {
//     tq.mu.Lock()
//     defer tq.mu.Unlock()
//     
//     for _, task := range tq.tasks {
//         if task.ID == taskID {
//             task.Status = status
//             task.UpdatedAt = time.Now()
//             return true
//         }
//     }
//     return false
// }
```

#### ä½¿ç”¨åœºæ™¯

âœ… **ç›‘æ§ä»»åŠ¡æ‰§è¡Œ**
```go
// è·å–æ‰€æœ‰è¿è¡Œä¸­çš„ä»»åŠ¡
runningTasks := queue.GetByStatus(agent.TaskStatusRunning)
fmt.Printf("å½“å‰æœ‰ %d ä¸ªä»»åŠ¡æ­£åœ¨æ‰§è¡Œ\n", len(runningTasks))
```

âœ… **ä»»åŠ¡çŠ¶æ€ç»Ÿè®¡**
```go
func getTaskStats(queue *scheduler.TaskQueue) map[string]int {
    stats := make(map[string]int)
    stats["pending"] = len(queue.GetByStatus(agent.TaskStatusPending))
    stats["running"] = len(queue.GetByStatus(agent.TaskStatusRunning))
    stats["completed"] = len(queue.GetByStatus(agent.TaskStatusCompleted))
    stats["failed"] = len(queue.GetByStatus(agent.TaskStatusFailed))
    return stats
}
```

âœ… **ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†**
```go
// å¼€å§‹æ‰§è¡Œä»»åŠ¡
queue.UpdateTaskStatus(taskID, agent.TaskStatusRunning)

// æ‰§è¡Œä»»åŠ¡é€»è¾‘...
result, err := executeTask(task)

// æ›´æ–°æœ€ç»ˆçŠ¶æ€
if err != nil {
    queue.UpdateTaskStatus(taskID, agent.TaskStatusFailed)
} else {
    queue.UpdateTaskStatus(taskID, agent.TaskStatusCompleted)
}
```

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### 1. ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆPriority Queueï¼‰

#### ä»€ä¹ˆæ˜¯ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Ÿ

ä¼˜å…ˆçº§é˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šçš„é˜Ÿåˆ—ï¼Œå…ƒç´ å‡ºé˜Ÿçš„é¡ºåºä¸æ˜¯å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰ï¼Œè€Œæ˜¯æ ¹æ®ä¼˜å…ˆçº§å†³å®šã€‚

```
æ™®é€šé˜Ÿåˆ—ï¼ˆFIFOï¼‰:
å…¥: A â†’ B â†’ C â†’ D
å‡º: A â†’ B â†’ C â†’ D ï¼ˆæŒ‰æ·»åŠ é¡ºåºï¼‰

ä¼˜å…ˆçº§é˜Ÿåˆ—:
å…¥: A(1) â†’ B(10) â†’ C(5) â†’ D(3)
å‡º: B(10) â†’ C(5) â†’ D(3) â†’ A(1) ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰
```

#### åº•å±‚å®ç°ï¼šå †ï¼ˆHeapï¼‰

Go Agent API ä½¿ç”¨**æœ€å¤§å †ï¼ˆMax Heapï¼‰**å®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼š

```
é€»è¾‘è§†å›¾ï¼ˆäºŒå‰æ ‘ï¼‰:
        [10]
       /    \
     [7]    [5]
     / \    /
   [3] [2][2]

ç‰©ç†å­˜å‚¨ï¼ˆæ•°ç»„ï¼‰:
[10, 7, 5, 3, 2, 2]
  0  1  2  3  4  5

çˆ¶å­å…³ç³»ï¼š
- çˆ¶èŠ‚ç‚¹ç´¢å¼• iï¼Œå·¦å­ = 2*i+1ï¼Œå³å­ = 2*i+2
- å­èŠ‚ç‚¹ç´¢å¼• iï¼Œçˆ¶èŠ‚ç‚¹ = (i-1)/2

å †çš„æ€§è´¨ï¼š
- çˆ¶èŠ‚ç‚¹çš„å€¼ â‰¥ å­èŠ‚ç‚¹çš„å€¼ï¼ˆæœ€å¤§å †ï¼‰
- å®Œå…¨äºŒå‰æ ‘ç»“æ„
- å †é¡¶æ˜¯æœ€å¤§å€¼
```

#### å †æ“ä½œå›¾è§£

**å…¥é˜Ÿæ“ä½œï¼ˆå‘ä¸Šè°ƒæ•´ï¼‰ï¼š**

```
åˆå§‹å †:
        [10]
       /    \
     [7]    [5]
     /
   [3]

æ­¥éª¤1: æ·»åŠ æ–°å…ƒç´  8 åˆ°æœ«å°¾
        [10]
       /    \
     [7]    [5]
     / \
   [3] [8]  â† æ–°å…ƒç´ 

æ­¥éª¤2: å‘ä¸Šæ¯”è¾ƒï¼Œ8 > 7ï¼Œäº¤æ¢ï¼
        [10]
       /    \
     [8]    [5]  â† äº¤æ¢
     / \
   [3] [7]  â† äº¤æ¢

æ­¥éª¤3: ç»§ç»­å‘ä¸Šï¼Œ8 < 10ï¼Œåœæ­¢
        [10]  â† å®Œæˆ
       /    \
     [8]    [5]
     / \
   [3] [7]
```

**å‡ºé˜Ÿæ“ä½œï¼ˆå‘ä¸‹è°ƒæ•´ï¼‰ï¼š**

```
åˆå§‹å †:
        [10]  â† è¦ç§»é™¤
       /    \
     [8]    [5]
     / \
   [3] [7]

æ­¥éª¤1: ç§»é™¤å †é¡¶ï¼Œç”¨æœ«å°¾å…ƒç´ æ›¿æ¢
        [7]   â† ä»æœ«å°¾ç§»åˆ°å †é¡¶
       /    \
     [8]    [5]
     /
   [3]

æ­¥éª¤2: å‘ä¸‹æ¯”è¾ƒï¼Œ7 < 8ï¼Œäº¤æ¢ï¼
        [8]   â† äº¤æ¢
       /    \
     [7]    [5]  â† äº¤æ¢
     /
   [3]

æ­¥éª¤3: ç»§ç»­å‘ä¸‹ï¼Œ7 > 3ï¼Œåœæ­¢
        [8]   â† å®Œæˆ
       /    \
     [7]    [5]
     /
   [3]
```

### 2. å¹¶å‘å®‰å…¨

#### ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘å®‰å…¨ï¼Ÿ

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¤šä¸ª goroutine å¯èƒ½åŒæ—¶è®¿é—®ä»»åŠ¡é˜Ÿåˆ—ï¼š

```
Goroutine 1: queue.Enqueue(task1)  â”
Goroutine 2: queue.Dequeue()       â”œâ”€ å¹¶å‘è®¿é—®
Goroutine 3: queue.Peek()          â”˜
```

#### é”çš„ä½¿ç”¨

```go
type TaskQueue struct {
    tasks []*agent.Task
    mu    sync.RWMutex  // è¯»å†™é”
}

// è¯»æ“ä½œï¼ˆå¯å¹¶å‘ï¼‰
func (tq *TaskQueue) Peek() *agent.Task {
    tq.mu.RLock()         // è·å–è¯»é”
    defer tq.mu.RUnlock() // é‡Šæ”¾è¯»é”
    
    if len(tq.tasks) == 0 {
        return nil
    }
    return tq.tasks[0]
}

// å†™æ“ä½œï¼ˆç‹¬å ï¼‰
func (tq *TaskQueue) Enqueue(task *agent.Task) {
    tq.mu.Lock()          // è·å–å†™é”
    defer tq.mu.Unlock()  // é‡Šæ”¾å†™é”
    
    heap.Push(tq, task)
}
```

#### è¯»å†™é”çš„ä¼˜åŠ¿

```
åœºæ™¯1: å¤šä¸ªè¯»æ“ä½œ
Reader 1: RLock() â”
Reader 2: RLock() â”œâ”€ å¯ä»¥å¹¶å‘æ‰§è¡Œ âœ“
Reader 3: RLock() â”˜

åœºæ™¯2: è¯»å†™æ“ä½œ
Reader:  RLock()  â”
Writer:  Lock()   â”œâ”€ Writer å¿…é¡»ç­‰å¾… Reader å®Œæˆ
Reader:  RUnlock()â”˜

åœºæ™¯3: å¤šä¸ªå†™æ“ä½œ
Writer 1: Lock()  â”
Writer 2: Lock()  â”œâ”€ Writer 2 å¿…é¡»ç­‰å¾… Writer 1
Writer 1: Unlock()â”˜
```

### 3. ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ

#### å®Œæ•´æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åˆ›å»ºä»»åŠ¡                                   â”‚
â”‚    task := &agent.Task{...}                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. åŠ å…¥é˜Ÿåˆ— (Status = Pending)               â”‚
â”‚    queue.Enqueue(task)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ç­‰å¾…è°ƒåº¦                                   â”‚
â”‚    åœ¨é˜Ÿåˆ—ä¸­æŒ‰ä¼˜å…ˆçº§æ’åº                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å¼€å§‹æ‰§è¡Œ (Status = Running)                â”‚
â”‚    task = queue.Dequeue()                    â”‚
â”‚    UpdateTaskStatus(task.ID, Running)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
        â†“               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5a. æˆåŠŸ     â”‚ â”‚ 5b. å¤±è´¥     â”‚
â”‚ Completed    â”‚ â”‚ Failed       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä¼˜å…ˆçº§è®¾è®¡

å»ºè®®ä½¿ç”¨å¸¸é‡å®šä¹‰ä¼˜å…ˆçº§ï¼š

```go
package main

// å®šä¹‰ä¼˜å…ˆçº§å¸¸é‡
const (
    // ç´§æ€¥ä»»åŠ¡ï¼šå½±å“ç”Ÿäº§ç¯å¢ƒï¼Œéœ€ç«‹å³å¤„ç†
    PriorityUrgent = 10
    
    // é«˜ä¼˜å…ˆçº§ï¼šé‡è¦åŠŸèƒ½ï¼Œå°½å¿«å¤„ç†
    PriorityHigh = 7
    
    // æ­£å¸¸ä¼˜å…ˆçº§ï¼šå¸¸è§„ä»»åŠ¡
    PriorityNormal = 5
    
    // ä½ä¼˜å…ˆçº§ï¼šéç´§æ€¥ä»»åŠ¡
    PriorityLow = 3
    
    // æœ€ä½ä¼˜å…ˆçº§ï¼šåå°ä»»åŠ¡ã€æ¸…ç†å·¥ä½œ
    PriorityMinimal = 1
)

// ä½¿ç”¨ç¤ºä¾‹
func createUrgentTask(input string) *agent.Task {
    return &agent.Task{
        ID:       uuid.New().String(),
        Priority: PriorityUrgent,  // ä½¿ç”¨å¸¸é‡
        Input:    input,
        Status:   agent.TaskStatusPending,
        CreatedAt: time.Now(),
    }
}
```

### 2. ä»»åŠ¡åˆ›å»ºå·¥å‚å‡½æ•°

```go
// ä»»åŠ¡åˆ›å»ºå™¨
type TaskBuilder struct {
    task *agent.Task
}

func NewTaskBuilder() *TaskBuilder {
    return &TaskBuilder{
        task: &agent.Task{
            ID:        uuid.New().String(),
            Status:    agent.TaskStatusPending,
            Priority:  PriorityNormal,
            CreatedAt: time.Now(),
            UpdatedAt: time.Now(),
        },
    }
}

func (b *TaskBuilder) WithAgentID(agentID string) *TaskBuilder {
    b.task.AgentID = agentID
    return b
}

func (b *TaskBuilder) WithPriority(priority int) *TaskBuilder {
    b.task.Priority = priority
    return b
}

func (b *TaskBuilder) WithInput(input string) *TaskBuilder {
    b.task.Input = input
    return b
}

func (b *TaskBuilder) Build() *agent.Task {
    return b.task
}

// ä½¿ç”¨ç¤ºä¾‹
task := NewTaskBuilder().
    WithAgentID("agent-001").
    WithPriority(PriorityHigh).
    WithInput("å¤„ç†ç”¨æˆ·æ•°æ®").
    Build()
```

### 3. é”™è¯¯å¤„ç†

```go
// å®‰å…¨çš„å‡ºé˜Ÿæ“ä½œ
func safeDequeue(queue *scheduler.TaskQueue) (*agent.Task, error) {
    task := queue.Dequeue()
    if task == nil {
        return nil, fmt.Errorf("é˜Ÿåˆ—ä¸ºç©º")
    }
    return task, nil
}

// å®‰å…¨çš„çŠ¶æ€æ›´æ–°
func safeUpdateStatus(queue *scheduler.TaskQueue, taskID string, status agent.TaskStatus) error {
    updated := queue.UpdateTaskStatus(taskID, status)
    if !updated {
        return fmt.Errorf("ä»»åŠ¡ %s ä¸å­˜åœ¨æˆ–æ›´æ–°å¤±è´¥", taskID)
    }
    return nil
}

// ä½¿ç”¨ç¤ºä¾‹
task, err := safeDequeue(queue)
if err != nil {
    log.Printf("å‡ºé˜Ÿå¤±è´¥: %v", err)
    return
}

err = safeUpdateStatus(queue, task.ID, agent.TaskStatusRunning)
if err != nil {
    log.Printf("çŠ¶æ€æ›´æ–°å¤±è´¥: %v", err)
    return
}
```

### 4. é˜Ÿåˆ—ç›‘æ§

```go
// é˜Ÿåˆ—ç»Ÿè®¡ä¿¡æ¯
type QueueStats struct {
    TotalTasks    int
    PendingTasks  int
    RunningTasks  int
    CompletedTasks int
    FailedTasks   int
    AvgPriority   float64
}

func GetQueueStats(queue *scheduler.TaskQueue) *QueueStats {
    allTasks := queue.List()
    stats := &QueueStats{
        TotalTasks: len(allTasks),
    }
    
    totalPriority := 0
    for _, task := range allTasks {
        totalPriority += task.Priority
        
        switch task.Status {
        case agent.TaskStatusPending:
            stats.PendingTasks++
        case agent.TaskStatusRunning:
            stats.RunningTasks++
        case agent.TaskStatusCompleted:
            stats.CompletedTasks++
        case agent.TaskStatusFailed:
            stats.FailedTasks++
        }
    }
    
    if len(allTasks) > 0 {
        stats.AvgPriority = float64(totalPriority) / float64(len(allTasks))
    }
    
    return stats
}

// ä½¿ç”¨ç¤ºä¾‹
stats := GetQueueStats(queue)
fmt.Printf("é˜Ÿåˆ—ç»Ÿè®¡:\n")
fmt.Printf("  æ€»ä»»åŠ¡æ•°: %d\n", stats.TotalTasks)
fmt.Printf("  å¾…å¤„ç†: %d\n", stats.PendingTasks)
fmt.Printf("  è¿è¡Œä¸­: %d\n", stats.RunningTasks)
fmt.Printf("  å·²å®Œæˆ: %d\n", stats.CompletedTasks)
fmt.Printf("  å¤±è´¥: %d\n", stats.FailedTasks)
fmt.Printf("  å¹³å‡ä¼˜å…ˆçº§: %.2f\n", stats.AvgPriority)
```

### 5. æ‰¹é‡æ“ä½œ

```go
// æ‰¹é‡å…¥é˜Ÿ
func BatchEnqueue(queue *scheduler.TaskQueue, tasks []*agent.Task) {
    for _, task := range tasks {
        queue.Enqueue(task)
    }
}

// æ‰¹é‡å¤„ç†
func ProcessBatch(queue *scheduler.TaskQueue, batchSize int) []*agent.Task {
    processed := make([]*agent.Task, 0, batchSize)
    
    for i := 0; i < batchSize && queue.Len() > 0; i++ {
        task := queue.Dequeue()
        if task != nil {
            // å¤„ç†ä»»åŠ¡...
            processed = append(processed, task)
        }
    }
    
    return processed
}

// æ¡ä»¶è¿‡æ»¤
func FilterTasks(queue *scheduler.TaskQueue, filter func(*agent.Task) bool) []*agent.Task {
    var filtered []*agent.Task
    allTasks := queue.List()
    
    for _, task := range allTasks {
        if filter(task) {
            filtered = append(filtered, task)
        }
    }
    
    return filtered
}

// ä½¿ç”¨ç¤ºä¾‹
// è·å–æ‰€æœ‰é«˜ä¼˜å…ˆçº§ä»»åŠ¡
highPriorityTasks := FilterTasks(queue, func(task *agent.Task) bool {
    return task.Priority >= PriorityHigh
})
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆä»»åŠ¡æ²¡æœ‰æŒ‰ç…§æ·»åŠ é¡ºåºæ‰§è¡Œï¼Ÿ

**A:** å› ä¸ºä½¿ç”¨çš„æ˜¯**ä¼˜å…ˆçº§é˜Ÿåˆ—**ï¼Œä¸æ˜¯æ™®é€šçš„ FIFO é˜Ÿåˆ—ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
- å¦‚æœéœ€è¦ FIFOï¼Œå°†æ‰€æœ‰ä»»åŠ¡ä¼˜å…ˆçº§è®¾ç½®ä¸ºç›¸åŒå€¼
- ç³»ç»Ÿä¼šåœ¨åŒä¼˜å…ˆçº§ä¸‹æŒ‰åˆ›å»ºæ—¶é—´æ’åº

```go
// FIFO æ¨¡å¼
task1.Priority = 1
task2.Priority = 1
task3.Priority = 1
// æ‰§è¡Œé¡ºåºï¼štask1 â†’ task2 â†’ task3
```

### Q2: åŒä¼˜å…ˆçº§çš„ä»»åŠ¡å¦‚ä½•æ’åºï¼Ÿ

**A:** æŒ‰**åˆ›å»ºæ—¶é—´**æ’åºï¼ˆæ—©åˆ›å»ºçš„å…ˆæ‰§è¡Œï¼‰ã€‚

```go
// Less æ–¹æ³•çš„å®ç°
func (tq *TaskQueue) Less(i, j int) bool {
    if tq.tasks[i].Priority == tq.tasks[j].Priority {
        // åŒä¼˜å…ˆçº§æ—¶ï¼Œæ—©åˆ›å»ºçš„ä¼˜å…ˆ
        return tq.tasks[i].CreatedAt.Before(tq.tasks[j].CreatedAt)
    }
    // å¦åˆ™ä¼˜å…ˆçº§é«˜çš„ä¼˜å…ˆ
    return tq.tasks[i].Priority > tq.tasks[j].Priority
}
```

### Q3: é˜Ÿåˆ—æœ‰å¤§å°é™åˆ¶å—ï¼Ÿ

**A:** å½“å‰å®ç°**æ— å¤§å°é™åˆ¶**ï¼Œä½†å¯ä»¥è‡ªå·±æ·»åŠ ï¼š

```go
const MaxQueueSize = 10000

func (tq *TaskQueue) Enqueue(task *agent.Task) error {
    if tq.Len() >= MaxQueueSize {
        return fmt.Errorf("é˜Ÿåˆ—å·²æ»¡ï¼Œæœ€å¤§å®¹é‡: %d", MaxQueueSize)
    }
    
    heap.Push(tq, task)
    return nil
}
```

### Q4: å¦‚ä½•å–æ¶ˆé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Ÿ

**A:** ä½¿ç”¨ `Remove()` æ–¹æ³•ï¼š

```go
// å–æ¶ˆæŒ‡å®šä»»åŠ¡
removed := queue.Remove("task-123")
if removed {
    fmt.Println("ä»»åŠ¡å·²å–æ¶ˆ")
} else {
    fmt.Println("ä»»åŠ¡ä¸å­˜åœ¨æˆ–å·²æ‰§è¡Œ")
}
```

### Q5: ä¸ºä»€ä¹ˆ UpdateTaskStatus ä¸ä¼šè°ƒæ•´å †ç»“æ„ï¼Ÿ

**A:** `UpdateTaskStatus` åªæ›´æ–°çŠ¶æ€ï¼Œä¸ä¿®æ”¹ä¼˜å…ˆçº§ã€‚å¦‚æœéœ€è¦æ›´æ–°ä¼˜å…ˆçº§ï¼Œåº”è¯¥ï¼š

```go
// é”™è¯¯æ–¹å¼
queue.UpdateTaskStatus(taskID, newStatus)
task.Priority = newPriority  // ä¸ä¼šé‡æ–°æ’åºï¼

// æ­£ç¡®æ–¹å¼
queue.Remove(taskID)  // å…ˆç§»é™¤
task.Priority = newPriority
queue.Enqueue(task)   // é‡æ–°åŠ å…¥
```

### Q6: é˜Ÿåˆ—æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ

**A:** æ˜¯çš„ï¼Œæ‰€æœ‰å…¬å¼€æ–¹æ³•éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚

```go
// å¯ä»¥å®‰å…¨åœ°å¹¶å‘è°ƒç”¨
go queue.Enqueue(task1)
go queue.Enqueue(task2)
go queue.Dequeue()
```

### Q7: å¦‚ä½•æŒä¹…åŒ–é˜Ÿåˆ—ï¼Ÿ

**A:** å½“å‰å®ç°åœ¨å†…å­˜ä¸­ï¼ŒæœåŠ¡é‡å¯ä¼šä¸¢å¤±ã€‚æŒä¹…åŒ–æ–¹æ¡ˆï¼š

```go
// æ–¹æ¡ˆ 1: åºåˆ—åŒ–åˆ°æ–‡ä»¶
func SaveQueue(queue *scheduler.TaskQueue, filename string) error {
    tasks := queue.List()
    data, err := json.Marshal(tasks)
    if err != nil {
        return err
    }
    return os.WriteFile(filename, data, 0644)
}

// æ–¹æ¡ˆ 2: å­˜å‚¨åˆ° Redis
func SaveToRedis(queue *scheduler.TaskQueue, redisClient *redis.Client) error {
    tasks := queue.List()
    for _, task := range tasks {
        data, _ := json.Marshal(task)
        redisClient.RPush(ctx, "task_queue", data)
    }
    return nil
}

// æ–¹æ¡ˆ 3: å­˜å‚¨åˆ°æ•°æ®åº“
func SaveToDB(queue *scheduler.TaskQueue, db *sql.DB) error {
    tasks := queue.List()
    for _, task := range tasks {
        _, err := db.Exec(`
            INSERT INTO tasks (id, agent_id, priority, status, input, created_at)
            VALUES (?, ?, ?, ?, ?, ?)
        `, task.ID, task.AgentID, task.Priority, task.Status, task.Input, task.CreatedAt)
        if err != nil {
            return err
        }
    }
    return nil
}
```

---

## ğŸ“ ä¸‹ä¸€æ­¥å­¦ä¹ 

### 1. è¿è¡Œå®Œæ•´çš„æœåŠ¡å™¨

```bash
# å¯åŠ¨ HTTP API æœåŠ¡å™¨
cd /Users/wangchunhua/Desktop/work/project/agent-learning-project/projects/phase2-practice/go-agent-api
go run cmd/server/main.go

# æœåŠ¡å™¨å¯åŠ¨åï¼š
# - API: http://localhost:8080
# - Swagger æ–‡æ¡£: http://localhost:8080/swagger/index.html
# - å¥åº·æ£€æŸ¥: http://localhost:8080/health
```

### 2. å°è¯• HTTP API

```bash
# 1. å¥åº·æ£€æŸ¥
curl http://localhost:8080/health

# 2. åˆ›å»ºä»»åŠ¡
curl -X POST http://localhost:8080/api/v1/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "agent_id": "agent-001",
    "type": "query",
    "input": "æµ‹è¯•ä»»åŠ¡",
    "priority": 5
  }'

# 3. æŸ¥è¯¢ä»»åŠ¡
curl http://localhost:8080/api/v1/tasks/{task_id}

# 4. è·å–ä»»åŠ¡ç»“æœ
curl http://localhost:8080/api/v1/tasks/{task_id}/result

# 5. è·å–ç»Ÿè®¡ä¿¡æ¯
curl http://localhost:8080/api/v1/tasks/stats
```

### 3. é˜…è¯»æ·±åº¦æ–‡æ¡£

- **è°ƒåº¦å™¨æ·±åº¦è§£æ**: `docs/SCHEDULER-DEEP-DIVE.md`
  - è¯¦ç»†çš„æ¶æ„è®¾è®¡
  - å¹¶å‘æ§åˆ¶æœºåˆ¶
  - æ€§èƒ½ä¼˜åŒ–æŠ€å·§
  - å®Œæ•´çš„æºç è§£æ

- **é¡¹ç›®å¿«é€Ÿå¼€å§‹**: `QUICKSTART.md`
  - ç¯å¢ƒé…ç½®
  - ä¾èµ–å®‰è£…
  - Docker éƒ¨ç½²
  - é…ç½®è¯´æ˜

- **API æ–‡æ¡£**: `README.md`
  - å®Œæ•´çš„ API åˆ—è¡¨
  - è¯·æ±‚/å“åº”ç¤ºä¾‹
  - é”™è¯¯å¤„ç†
  - æœ€ä½³å®è·µ

### 4. æ‰©å±•ç»ƒä¹ 

å°è¯•å®ç°ä»¥ä¸‹åŠŸèƒ½æ¥åŠ æ·±ç†è§£ï¼š

#### ç»ƒä¹  1: ä»»åŠ¡è¶…æ—¶ç›‘æ§

```go
// å®ç°ä¸€ä¸ªç›‘æ§å™¨ï¼Œæ£€æµ‹è¿è¡Œæ—¶é—´è¿‡é•¿çš„ä»»åŠ¡
type TaskMonitor struct {
    queue   *scheduler.TaskQueue
    timeout time.Duration
}

func (m *TaskMonitor) CheckTimeouts() []*agent.Task {
    // TODO: å®ç°è¶…æ—¶æ£€æµ‹é€»è¾‘
    // æç¤ºï¼š
    // 1. è·å–æ‰€æœ‰ Running çŠ¶æ€çš„ä»»åŠ¡
    // 2. æ£€æŸ¥ StartedAt æ—¶é—´
    // 3. è¿”å›è¶…æ—¶çš„ä»»åŠ¡åˆ—è¡¨
}
```

#### ç»ƒä¹  2: ä¼˜å…ˆçº§åŠ¨æ€è°ƒæ•´

```go
// å®ç°ä¼˜å…ˆçº§è€åŒ–æœºåˆ¶ï¼šç­‰å¾…æ—¶é—´è¶Šé•¿ï¼Œä¼˜å…ˆçº§è¶Šé«˜
func AdjustPriorities(queue *scheduler.TaskQueue) {
    // TODO: å®ç°ä¼˜å…ˆçº§è°ƒæ•´é€»è¾‘
    // æç¤ºï¼š
    // 1. éå†æ‰€æœ‰ Pending ä»»åŠ¡
    // 2. æ ¹æ®ç­‰å¾…æ—¶é—´è°ƒæ•´ä¼˜å…ˆçº§
    // 3. é‡æ–°å…¥é˜Ÿ
}
```

#### ç»ƒä¹  3: ä»»åŠ¡ä¾èµ–ç®¡ç†

```go
// å®ç°ä»»åŠ¡ä¾èµ–ï¼šæŸäº›ä»»åŠ¡å¿…é¡»åœ¨å…¶ä»–ä»»åŠ¡å®Œæˆåæ‰èƒ½æ‰§è¡Œ
type TaskDependency struct {
    TaskID       string
    DependsOn    []string  // ä¾èµ–çš„ä»»åŠ¡ ID åˆ—è¡¨
}

func CheckDependencies(task *agent.Task, dependencies map[string]*TaskDependency) bool {
    // TODO: å®ç°ä¾èµ–æ£€æŸ¥é€»è¾‘
    // æç¤ºï¼š
    // 1. æŸ¥æ‰¾ä»»åŠ¡çš„ä¾èµ–åˆ—è¡¨
    // 2. æ£€æŸ¥æ‰€æœ‰ä¾èµ–ä»»åŠ¡æ˜¯å¦å·²å®Œæˆ
    // 3. è¿”å›æ˜¯å¦å¯ä»¥æ‰§è¡Œ
}
```

### 5. å®æˆ˜é¡¹ç›®

å°è¯•æ„å»ºä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ï¼š

- **ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ**ï¼šå®ç°ä¸€ä¸ªæ”¯æŒå®šæ—¶ä»»åŠ¡ã€é‡è¯•æœºåˆ¶çš„è°ƒåº¦å™¨
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šåŸºäºä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°æ¶ˆæ¯åˆ†å‘ç³»ç»Ÿ
- **èµ„æºç®¡ç†å™¨**ï¼šå®ç° CPU/å†…å­˜èµ„æºçš„ä¼˜å…ˆçº§åˆ†é…
- **äº‹ä»¶å¤„ç†ç³»ç»Ÿ**ï¼šæ„å»ºåŸºäºä¼˜å…ˆçº§çš„äº‹ä»¶å¤„ç†æ¡†æ¶

---

## ğŸ“Š æ€§èƒ½å‚è€ƒ

### åŸºå‡†æµ‹è¯•ç»“æœ

```
æµ‹è¯•ç¯å¢ƒ:
- Go 1.23.0
- macOS M1
- 8GB RAM

æµ‹è¯•ç»“æœ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ“ä½œ        â”‚ ä»»åŠ¡æ•°é‡   â”‚ æ€»è€—æ—¶   â”‚ å¹³å‡è€—æ—¶  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Enqueue     â”‚ 1,000      â”‚ ~2ms     â”‚ 0.002ms   â”‚
â”‚ Enqueue     â”‚ 10,000     â”‚ ~25ms    â”‚ 0.0025ms  â”‚
â”‚ Enqueue     â”‚ 100,000    â”‚ ~300ms   â”‚ 0.003ms   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dequeue     â”‚ 1,000      â”‚ ~2ms     â”‚ 0.002ms   â”‚
â”‚ Dequeue     â”‚ 10,000     â”‚ ~26ms    â”‚ 0.0026ms  â”‚
â”‚ Dequeue     â”‚ 100,000    â”‚ ~320ms   â”‚ 0.0032ms  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Peek        â”‚ ä»»æ„       â”‚ <0.001ms â”‚ 0.0001ms  â”‚
â”‚ Len         â”‚ ä»»æ„       â”‚ <0.001ms â”‚ 0.0001ms  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ—¶é—´å¤æ‚åº¦éªŒè¯:
- O(log n) æ“ä½œï¼ˆå…¥é˜Ÿ/å‡ºé˜Ÿï¼‰ç¬¦åˆé¢„æœŸ
- O(1) æ“ä½œï¼ˆæŸ¥çœ‹/é•¿åº¦ï¼‰æ€§èƒ½ä¼˜å¼‚
```

---

## ğŸ“ è·å–å¸®åŠ©

é‡åˆ°é—®é¢˜ï¼Ÿä»¥ä¸‹æ˜¯è·å–å¸®åŠ©çš„é€”å¾„ï¼š

1. **æŸ¥çœ‹æ–‡æ¡£**
   - å®Œæ•´æ–‡æ¡£ï¼š`README.md`
   - æ·±åº¦è§£æï¼š`docs/SCHEDULER-DEEP-DIVE.md`
   - å¿«é€Ÿå¼€å§‹ï¼š`QUICKSTART.md`

2. **æŸ¥çœ‹ç¤ºä¾‹**
   - åŸºç¡€ç¤ºä¾‹ï¼š`examples/basic-usage/`
   - æ›´å¤šç¤ºä¾‹ï¼š`examples/` ç›®å½•

3. **æ£€æŸ¥æ—¥å¿—**
   - è¿è¡Œç¤ºä¾‹æ—¶æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º
   - æœåŠ¡å™¨æ—¥å¿—ï¼šæŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œæƒ…å†µ

4. **è°ƒè¯•æŠ€å·§**
   ```go
   // æ‰“å°é˜Ÿåˆ—çŠ¶æ€
   fmt.Printf("é˜Ÿåˆ—é•¿åº¦: %d\n", queue.Len())
   
   // æ‰“å°æ‰€æœ‰ä»»åŠ¡
   for i, task := range queue.List() {
       fmt.Printf("%d. %s (ä¼˜å…ˆçº§: %d, çŠ¶æ€: %s)\n",
           i+1, task.ID, task.Priority, task.Status)
   }
   
   // æ‰“å°å †é¡¶ä»»åŠ¡
   if top := queue.Peek(); top != nil {
       fmt.Printf("å †é¡¶: %s (ä¼˜å…ˆçº§: %d)\n", top.ID, top.Priority)
   }
   ```

---

## ğŸ‰ æ€»ç»“

é€šè¿‡æœ¬ç¤ºä¾‹ï¼Œæ‚¨å·²ç»å­¦ä¼šäº†ï¼š

âœ… **åŸºç¡€æ¦‚å¿µ**
- ä»»åŠ¡é˜Ÿåˆ—çš„åˆ›å»ºå’Œä½¿ç”¨
- ä¼˜å…ˆçº§é˜Ÿåˆ—çš„å·¥ä½œåŸç†
- å †æ•°æ®ç»“æ„çš„å®é™…åº”ç”¨

âœ… **æ ¸å¿ƒæ“ä½œ**
- å…¥é˜Ÿï¼ˆEnqueueï¼‰- æ·»åŠ ä»»åŠ¡
- å‡ºé˜Ÿï¼ˆDequeueï¼‰- è·å–æœ€é«˜ä¼˜å…ˆçº§ä»»åŠ¡
- æŸ¥çœ‹å †é¡¶ï¼ˆPeekï¼‰- æŸ¥çœ‹ä½†ä¸ç§»é™¤
- çŠ¶æ€ç®¡ç† - æŸ¥è¯¢å’Œæ›´æ–°ä»»åŠ¡çŠ¶æ€

âœ… **å®æˆ˜åº”ç”¨**
- æ¨¡æ‹ŸçœŸå®çš„ä»»åŠ¡è°ƒåº¦åœºæ™¯
- ç†è§£ä¼˜å…ˆçº§è®¾è®¡çš„é‡è¦æ€§
- æŒæ¡ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†

âœ… **æœ€ä½³å®è·µ**
- ä½¿ç”¨å¸¸é‡å®šä¹‰ä¼˜å…ˆçº§
- å·¥å‚æ¨¡å¼åˆ›å»ºä»»åŠ¡
- å®‰å…¨çš„é”™è¯¯å¤„ç†
- é˜Ÿåˆ—ç›‘æ§å’Œç»Ÿè®¡

ç°åœ¨æ‚¨å¯ä»¥å¼€å§‹æ„å»ºè‡ªå·±çš„ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿäº†ï¼ğŸš€

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2026-01-29  
**ä½œè€…**: Go Agent API Team
