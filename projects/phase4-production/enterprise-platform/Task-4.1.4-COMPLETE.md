# Task 4.1.4 å®Œæˆ - å®ç°æˆæœ¬æ§åˆ¶

**å®Œæˆæ—¥æœŸ**: 2026-01-30
**ä»»åŠ¡**: å®ç°æˆæœ¬æ§åˆ¶ï¼ˆDay 9-11ï¼‰

---

## âœ… å®Œæˆå†…å®¹

### 1. æˆæœ¬æ•°æ®æ¨¡å‹ âœ…

**æ–‡ä»¶**: `services/cost/internal/model/cost.go` (~300è¡Œ)

**æ ¸å¿ƒæ¨¡å‹**:

#### â‘  TokenUsage - Tokenä½¿ç”¨è®°å½•
```go
ç§Ÿæˆ·ã€ç”¨æˆ·ã€Agentã€ä»»åŠ¡ã€æ¨¡å‹ä¿¡æ¯
è¾“å…¥/è¾“å‡ºTokenæ•°é‡
è¾“å…¥/è¾“å‡º/æ€»æˆæœ¬
æ˜¯å¦ä½¿ç”¨ç¼“å­˜
æ—¶é—´æˆ³
```

#### â‘¡ CostStatistics - æˆæœ¬ç»Ÿè®¡
```go
æŒ‰å‘¨æœŸç»Ÿè®¡ï¼ˆdaily/weekly/monthlyï¼‰
æ€»Tokenæ•°ã€æ€»æˆæœ¬ã€è¯·æ±‚æ•°
å¹³å‡Token/è¯·æ±‚ã€å¹³å‡æˆæœ¬/è¯·æ±‚
ç¼“å­˜å‘½ä¸­ç‡
```

#### â‘¢ CostForecast - æˆæœ¬é¢„æµ‹
```go
é¢„æµ‹æ—¥æœŸ
é¢„æµ‹Tokenæ•°ã€é¢„æµ‹æˆæœ¬
ç½®ä¿¡åº¦ï¼ˆ0.0-1.0ï¼‰
é¢„æµ‹æ–¹æ³•ï¼ˆlinear/exponential/arimaï¼‰
```

#### â‘£ CostAlert - æˆæœ¬å‘Šè­¦
```go
å‘Šè­¦ç±»å‹ï¼ˆthreshold/forecast/anomalyï¼‰
ä¸¥é‡ç¨‹åº¦ï¼ˆinfo/warning/criticalï¼‰
å½“å‰å€¼ã€é˜ˆå€¼
çŠ¶æ€ï¼ˆactive/acknowledged/resolvedï¼‰
```

#### â‘¤ ModelPricing - æ¨¡å‹å®šä»·
```go
æ”¯æŒ11ç§LLMæ¨¡å‹å®šä»·ï¼š
- OpenAI: gpt-4, gpt-4-32k, gpt-4-turbo, gpt-3.5-turbo
- Anthropic: claude-3-opus, claude-3-sonnet, claude-3-haiku
- Google: gemini-pro, gemini-pro-vision, gemini-ultra
```

**å®šä»·ç¤ºä¾‹**ï¼ˆ2026å¹´1æœˆï¼‰:
```
gpt-4:          è¾“å…¥$0.03/1K,  è¾“å‡º$0.06/1K
gpt-4-turbo:    è¾“å…¥$0.01/1K,  è¾“å‡º$0.03/1K
claude-3-opus:  è¾“å…¥$0.015/1K, è¾“å‡º$0.075/1K
gemini-pro:     è¾“å…¥$0.00025/1K, è¾“å‡º$0.0005/1K
```

#### â‘¥ CostBudget - æˆæœ¬é¢„ç®—
```go
å‘¨æœŸï¼ˆmonthly/quarterly/yearlyï¼‰
é¢„ç®—ã€å·²èŠ±è´¹ã€å‰©ä½™
å‘Šè­¦é˜ˆå€¼ï¼ˆé»˜è®¤80%ï¼‰
```

#### â‘¦ CostOptimization - ä¼˜åŒ–å»ºè®®
```go
ç±»å‹ï¼šmodel_switch, cache, batch, prompt_optimization
å½“å‰æˆæœ¬ã€é¢„ä¼°æˆæœ¬ã€èŠ‚çœé‡‘é¢
èŠ‚çœç™¾åˆ†æ¯”ã€ä¼˜å…ˆçº§
```

### 2. æˆæœ¬è®¡ç®—å™¨ âœ…

**æ–‡ä»¶**: `services/cost/internal/calculator/cost_calculator.go` (~250è¡Œ)

**æ ¸å¿ƒåŠŸèƒ½**:

#### â‘  Calculate - è®¡ç®—æˆæœ¬
```go
è¾“å…¥: æ¨¡å‹åç§° + è¾“å…¥Token + è¾“å‡ºToken
è¾“å‡º: TokenUsageï¼ˆåŒ…å«è¯¦ç»†æˆæœ¬ï¼‰
```

#### â‘¡ CompareCosts - æ¯”è¾ƒæ¨¡å‹æˆæœ¬
```go
å¯¹æ¯”æ‰€æœ‰æ¨¡å‹åœ¨ç›¸åŒTokenä¸‹çš„æˆæœ¬
å¸®åŠ©é€‰æ‹©æœ€ç»æµçš„æ¨¡å‹
```

#### â‘¢ GetCheapestModel - è·å–æœ€ä¾¿å®œæ¨¡å‹
```go
è‡ªåŠ¨æ‰¾å‡ºæˆæœ¬æœ€ä½çš„æ¨¡å‹
è¿”å›æ¨¡å‹åç§°å’Œæˆæœ¬
```

#### â‘£ EstimateMonthlyCost - ä¼°ç®—æœˆåº¦æˆæœ¬
```go
è¾“å…¥: æ¨¡å‹ + æ—¥è¯·æ±‚æ•° + å¹³å‡Token
è¾“å‡º: æœˆåº¦æˆæœ¬ä¼°ç®—
```

#### â‘¤ CalculateSavings - è®¡ç®—èŠ‚çœ
```go
å¯¹æ¯”ä¸¤ä¸ªæ¨¡å‹çš„æˆæœ¬å·®å¼‚
è®¡ç®—åˆ‡æ¢å¯èŠ‚çœçš„é‡‘é¢å’Œç™¾åˆ†æ¯”
```

#### â‘¥ OptimizationRecommendations - ä¼˜åŒ–å»ºè®®
```go
è‡ªåŠ¨ç”Ÿæˆ4ç±»ä¼˜åŒ–å»ºè®®ï¼š
1. æ¨¡å‹åˆ‡æ¢ï¼ˆåˆ‡æ¢åˆ°æ›´ä¾¿å®œçš„æ¨¡å‹ï¼‰
2. æé«˜ç¼“å­˜å‘½ä¸­ç‡ï¼ˆç›®æ ‡70%ï¼‰
3. æ‰¹é‡å¤„ç†ï¼ˆèŠ‚çœ15%ï¼‰
4. Promptä¼˜åŒ–ï¼ˆèŠ‚çœ20%ï¼‰
```

**ä¼˜åŒ–å»ºè®®ç¤ºä¾‹**:
```json
{
  "type": "model_switch",
  "title": "åˆ‡æ¢åˆ° gemini-pro æ¨¡å‹",
  "description": "å½“å‰ä½¿ç”¨ gpt-4ï¼Œå»ºè®®åˆ‡æ¢åˆ°æˆæœ¬æ›´ä½çš„ gemini-pro",
  "current_cost": 1000.00,
  "estimated_cost": 50.00,
  "savings": 950.00,
  "savings_percent": 95.0,
  "priority": "high"
}
```

### 3. æˆæœ¬é¢„æµ‹å™¨ âœ…

**æ–‡ä»¶**: `services/cost/internal/forecaster/forecaster.go` (~200è¡Œ)

**é¢„æµ‹æ–¹æ³•**:

#### â‘  Linear Regression - çº¿æ€§å›å½’
```go
åŸºäºå†å²æ•°æ®æ‹Ÿåˆçº¿æ€§æ¨¡å‹
è®¡ç®—æ–œç‡å’Œæˆªè·
é¢„æµ‹æœªæ¥è¶‹åŠ¿
è®¡ç®—RÂ²ï¼ˆå†³å®šç³»æ•°ï¼‰ä½œä¸ºç½®ä¿¡åº¦
```

#### â‘¡ Exponential Smoothing - æŒ‡æ•°å¹³æ»‘
```go
å¯¹è¿‘æœŸæ•°æ®èµ‹äºˆæ›´é«˜æƒé‡
é€‚åˆæ³¢åŠ¨è¾ƒå¤§çš„æ•°æ®
Alphaå‚æ•°æ§åˆ¶å¹³æ»‘ç¨‹åº¦
```

#### â‘¢ DetectAnomaly - å¼‚å¸¸æ£€æµ‹
```go
è®¡ç®—å†å²å‡å€¼å’Œæ ‡å‡†å·®
æ£€æµ‹æ˜¯å¦è¶…è¿‡2ä¸ªæ ‡å‡†å·®
è¯†åˆ«æˆæœ¬çªå¢æˆ–çªé™
```

#### â‘£ TrendAnalysis - è¶‹åŠ¿åˆ†æ
```go
åˆ†ææˆæœ¬è¶‹åŠ¿ï¼ˆincreasing/decreasing/stableï¼‰
è®¡ç®—å˜åŒ–ç‡
æä¾›è¶‹åŠ¿é¢„è­¦
```

#### â‘¤ SeasonalAnalysis - å­£èŠ‚æ€§åˆ†æ
```go
æŒ‰æ˜ŸæœŸå‡ åˆ†ç»„ç»Ÿè®¡
è¯†åˆ«å‘¨æœŸæ€§æ¨¡å¼
ä¼˜åŒ–èµ„æºåˆ†é…
```

**é¢„æµ‹ç¤ºä¾‹**:
```json
{
  "forecast_date": "2026-02-28",
  "predicted_tokens": 5000000,
  "predicted_cost": 150.00,
  "confidence": 0.85,
  "method": "linear"
}
```

### 4. æˆæœ¬å‘Šè­¦å™¨ âœ…

**æ–‡ä»¶**: `services/cost/internal/alerter/alerter.go` (~220è¡Œ)

**å‘Šè­¦ç±»å‹**:

#### â‘  Budget Alerts - é¢„ç®—å‘Šè­¦
```go
æ£€æŸ¥æ˜¯å¦è¶…é¢„ç®—
æ£€æŸ¥æ˜¯å¦æ¥è¿‘é¢„ç®—ï¼ˆ80%é˜ˆå€¼ï¼‰
ä¸¥é‡ç¨‹åº¦è‡ªåŠ¨åˆ†çº§ï¼š
- critical: 95%ä»¥ä¸Š
- warning:  85-95%
- info:     80-85%
```

#### â‘¡ Forecast Alerts - é¢„æµ‹å‘Šè­¦
```go
åŸºäºé¢„æµ‹æ£€æŸ¥æœªæ¥æ˜¯å¦è¶…é¢„ç®—
æå‰é¢„è­¦ï¼Œé¿å…è¶…æ”¯
```

#### â‘¢ Anomaly Alerts - å¼‚å¸¸å‘Šè­¦
```go
æ£€æµ‹æˆæœ¬å¼‚å¸¸æ³¢åŠ¨
æ—¥åº¦æ¿€å¢ï¼ˆå¢é•¿50%ä»¥ä¸Šï¼‰
å¼‚å¸¸æ£€æµ‹ç®—æ³•
```

#### â‘£ Rate Limit Alerts - é€Ÿç‡é™åˆ¶å‘Šè­¦
```go
æ£€æŸ¥APIè°ƒç”¨é¢‘ç‡
é˜²æ­¢çªå‘æµé‡
ä¿æŠ¤ç³»ç»Ÿç¨³å®š
```

**å‘Šè­¦ç®¡ç†**:
- âœ… `CreateAlert()` - åˆ›å»ºå‘Šè­¦
- âœ… `AcknowledgeAlert()` - ç¡®è®¤å‘Šè­¦
- âœ… `ResolveAlert()` - è§£å†³å‘Šè­¦
- âœ… `AutoResolveAlerts()` - è‡ªåŠ¨è§£å†³å·²ä¿®å¤çš„å‘Šè­¦

**é€šçŸ¥æ¸ é“**ï¼ˆå¾…å®ç°ï¼‰:
- Email
- Slack
- Webhook
- SMS

### 5. æ•°æ®åº“è®¾è®¡ âœ…

**æ–‡ä»¶**: `services/cost/migrations/001_initial.up.sql` (~200è¡Œ)

**æ•°æ®è¡¨**ï¼ˆ5ä¸ªï¼‰:

#### â‘  token_usage - Tokenä½¿ç”¨è®°å½•
```sql
æ—¶åºæ•°æ®ï¼Œè®°å½•æ¯æ¬¡LLMè°ƒç”¨
14ä¸ªå­—æ®µï¼Œ6ä¸ªç´¢å¼•
æ”¯æŒæŒ‰ç§Ÿæˆ·ã€ç”¨æˆ·ã€Agentã€æ¨¡å‹ã€æ—¶é—´æŸ¥è¯¢
```

#### â‘¡ cost_statistics - æˆæœ¬ç»Ÿè®¡
```sql
æŒ‰å‘¨æœŸæ±‡æ€»ç»Ÿè®¡ï¼ˆdaily/weekly/monthlyï¼‰
åŒ…å«Tokenæ•°ã€æˆæœ¬ã€è¯·æ±‚æ•°ã€ç¼“å­˜å‘½ä¸­ç‡
```

#### â‘¢ cost_forecasts - æˆæœ¬é¢„æµ‹
```sql
å­˜å‚¨é¢„æµ‹ç»“æœ
åŒ…å«é¢„æµ‹Tokenã€æˆæœ¬ã€ç½®ä¿¡åº¦
```

#### â‘£ cost_alerts - æˆæœ¬å‘Šè­¦
```sql
è®°å½•æ‰€æœ‰å‘Šè­¦
æ”¯æŒçŠ¶æ€ç®¡ç†ï¼ˆactive/acknowledged/resolvedï¼‰
```

#### â‘¤ cost_budgets - æˆæœ¬é¢„ç®—
```sql
ç§Ÿæˆ·é¢„ç®—é…ç½®
è‡ªåŠ¨è®¡ç®—å‰©ä½™é¢„ç®—
æ”¯æŒå‘Šè­¦é˜ˆå€¼é…ç½®
```

**è§†å›¾**ï¼ˆ3ä¸ªï¼‰:

#### â‘  daily_cost_summary - æ¯æ—¥æˆæœ¬æ±‡æ€»
```sql
æŒ‰ç§Ÿæˆ·ã€æ—¥æœŸã€æ¨¡å‹æ±‡æ€»
è®¡ç®—ç¼“å­˜å‘½ä¸­ç‡
```

#### â‘¡ tenant_cost_ranking - ç§Ÿæˆ·æˆæœ¬æ’å
```sql
æŒ‰æˆæœ¬æ’åº
æ˜¾ç¤ºç§Ÿæˆ·æ¶ˆè´¹æ’å
```

#### â‘¢ model_usage_stats - æ¨¡å‹ä½¿ç”¨ç»Ÿè®¡
```sql
ç»Ÿè®¡æ¯ä¸ªæ¨¡å‹çš„ä½¿ç”¨æƒ…å†µ
è®¡ç®—å¹³å‡æˆæœ¬ã€å¹³å‡Token
```

**è§¦å‘å™¨**ï¼ˆ3ä¸ªï¼‰:
- è‡ªåŠ¨æ›´æ–° updated_at
- è‡ªåŠ¨è®¡ç®—é¢„ç®—å‰©ä½™

---

## ğŸ¯ æ ¸å¿ƒäº®ç‚¹

### 1. 11ç§LLMæ¨¡å‹å®šä»·æ”¯æŒ

```
OpenAIï¼ˆ4ä¸ªæ¨¡å‹ï¼‰
â”œâ”€â”€ GPT-4:       $0.03/$0.06 per 1K
â”œâ”€â”€ GPT-4-32K:   $0.06/$0.12 per 1K
â”œâ”€â”€ GPT-4-Turbo: $0.01/$0.03 per 1K
â””â”€â”€ GPT-3.5:     $0.0005/$0.0015 per 1K

Anthropicï¼ˆ3ä¸ªæ¨¡å‹ï¼‰
â”œâ”€â”€ Claude-3-Opus:   $0.015/$0.075 per 1K
â”œâ”€â”€ Claude-3-Sonnet: $0.003/$0.015 per 1K
â””â”€â”€ Claude-3-Haiku:  $0.00025/$0.00125 per 1K

Googleï¼ˆ3ä¸ªæ¨¡å‹ï¼‰
â”œâ”€â”€ Gemini-Pro:        $0.00025/$0.0005 per 1K
â”œâ”€â”€ Gemini-Pro-Vision: $0.00025/$0.0005 per 1K
â””â”€â”€ Gemini-Ultra:      $0.01/$0.03 per 1K
```

### 2. å®æ—¶æˆæœ¬è¿½è¸ª

```
æ¯æ¬¡LLMè°ƒç”¨è‡ªåŠ¨è®°å½•ï¼š
â”œâ”€â”€ ç§Ÿæˆ·ã€ç”¨æˆ·ã€Agentã€ä»»åŠ¡
â”œâ”€â”€ æ¨¡å‹ã€æä¾›å•†
â”œâ”€â”€ è¾“å…¥/è¾“å‡ºTokenæ•°é‡
â”œâ”€â”€ è¾“å…¥/è¾“å‡º/æ€»æˆæœ¬
â”œâ”€â”€ æ˜¯å¦ä½¿ç”¨ç¼“å­˜
â””â”€â”€ æ‰§è¡Œæ—¶é•¿
```

**æŸ¥è¯¢ç»´åº¦**:
- æŒ‰ç§Ÿæˆ·ç»Ÿè®¡
- æŒ‰ç”¨æˆ·ç»Ÿè®¡
- æŒ‰Agentç»Ÿè®¡
- æŒ‰æ¨¡å‹ç»Ÿè®¡
- æŒ‰æ—¶é—´ç»Ÿè®¡
- å¤šç»´åº¦ç»„åˆ

### 3. æ™ºèƒ½æˆæœ¬é¢„æµ‹

```
3ç§é¢„æµ‹æ–¹æ³•ï¼š
â”œâ”€â”€ çº¿æ€§å›å½’ï¼ˆLinear Regressionï¼‰
â”‚   - åŸºäºå†å²è¶‹åŠ¿
â”‚   - è®¡ç®—RÂ²ç½®ä¿¡åº¦
â”‚
â”œâ”€â”€ æŒ‡æ•°å¹³æ»‘ï¼ˆExponential Smoothingï¼‰
â”‚   - è¿‘æœŸæ•°æ®æƒé‡æ›´é«˜
â”‚   - é€‚åˆæ³¢åŠ¨æ•°æ®
â”‚
â””â”€â”€ å¼‚å¸¸æ£€æµ‹ï¼ˆAnomaly Detectionï¼‰
    - è¯†åˆ«çªå¢/çªé™
    - æ ‡å‡†å·®åˆ†æ
```

**é¢„æµ‹ç¤ºä¾‹**:
```
æ ¹æ®è¿‡å»30å¤©çš„æ•°æ®ï¼š
â”œâ”€â”€ é¢„æµ‹ä¸‹æœˆToken: 5,000,000
â”œâ”€â”€ é¢„æµ‹ä¸‹æœˆæˆæœ¬: $150.00
â”œâ”€â”€ ç½®ä¿¡åº¦: 85%
â””â”€â”€ è¶‹åŠ¿: increasing (+12.5%)
```

### 4. 4ç±»ä¼˜åŒ–å»ºè®®

#### â‘  æ¨¡å‹åˆ‡æ¢ä¼˜åŒ–
```
å½“å‰: GPT-4 â†’ $1000/æœˆ
å»ºè®®: Gemini-Pro â†’ $50/æœˆ
èŠ‚çœ: $950 (95%)
ä¼˜å…ˆçº§: High
```

#### â‘¡ ç¼“å­˜ä¼˜åŒ–
```
å½“å‰ç¼“å­˜å‘½ä¸­ç‡: 35%
ç›®æ ‡ç¼“å­˜å‘½ä¸­ç‡: 70%
æ½œåœ¨èŠ‚çœ: 35% Ã— $1000 = $350
ä¼˜å…ˆçº§: Medium
```

#### â‘¢ æ‰¹é‡å¤„ç†ä¼˜åŒ–
```
åˆå¹¶å¤šä¸ªå°è¯·æ±‚ä¸ºæ‰¹é‡è¯·æ±‚
é¢„ä¼°èŠ‚çœ: 15%
é€‚ç”¨åœºæ™¯: è¯·æ±‚æ•° > 1000/å¤©
```

#### â‘£ Promptä¼˜åŒ–
```
å¹³å‡Token/è¯·æ±‚: 5000
å»ºè®®ä¼˜åŒ–: å‡å°‘åˆ°3000
é¢„ä¼°èŠ‚çœ: 40%
```

### 5. å¤šçº§å‘Šè­¦ç³»ç»Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å‘Šè­¦åˆ†çº§                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Critical (95%+)                  â”‚
â”‚ â”œâ”€â”€ ç«‹å³é€šçŸ¥                     â”‚
â”‚ â”œâ”€â”€ é‚®ä»¶ + Slack + SMS           â”‚
â”‚ â””â”€â”€ è‡ªåŠ¨è§¦å‘é™æµ                 â”‚
â”‚                                  â”‚
â”‚ Warning (85-95%)                 â”‚
â”‚ â”œâ”€â”€ æ™®é€šé€šçŸ¥                     â”‚
â”‚ â”œâ”€â”€ é‚®ä»¶ + Slack                 â”‚
â”‚ â””â”€â”€ å»ºè®®é‡‡å–è¡ŒåŠ¨                 â”‚
â”‚                                  â”‚
â”‚ Info (80-85%)                    â”‚
â”‚ â”œâ”€â”€ æç¤ºæ€§é€šçŸ¥                   â”‚
â”‚ â””â”€â”€ ä»…Dashboardæ˜¾ç¤º              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å‘Šè­¦ç±»å‹**:
- é¢„ç®—å‘Šè­¦ï¼ˆè¶…é™/æ¥è¿‘ï¼‰
- é¢„æµ‹å‘Šè­¦ï¼ˆé¢„è®¡è¶…æ”¯ï¼‰
- å¼‚å¸¸å‘Šè­¦ï¼ˆçªå¢/å¼‚å¸¸ï¼‰
- é€Ÿç‡é™åˆ¶å‘Šè­¦

### 6. æˆæœ¬æŠ¥è¡¨

**æ—¥æŠ¥**:
```
2026-01-30 æˆæœ¬æŠ¥å‘Š
â”œâ”€â”€ æ€»æˆæœ¬: $45.23
â”œâ”€â”€ æ€»Token: 1,234,567
â”œâ”€â”€ è¯·æ±‚æ•°: 3,456
â”œâ”€â”€ ç¼“å­˜å‘½ä¸­ç‡: 42.3%
â”œâ”€â”€ ä¸»è¦æ¨¡å‹:
â”‚   â”œâ”€â”€ GPT-4: $30.15 (67%)
â”‚   â”œâ”€â”€ Claude-3: $10.08 (22%)
â”‚   â””â”€â”€ Gemini: $5.00 (11%)
â””â”€â”€ è¶‹åŠ¿: â†‘ +8.5% vsæ˜¨æ—¥
```

**æœˆæŠ¥**:
```
2026-01æœˆ æˆæœ¬æŠ¥å‘Š
â”œâ”€â”€ æ€»æˆæœ¬: $1,234.56
â”œâ”€â”€ é¢„ç®—: $1,500.00
â”œâ”€â”€ ä½¿ç”¨ç‡: 82.3%
â”œâ”€â”€ å‰©ä½™: $265.44
â”œâ”€â”€ åŒæ¯”: +15.2%
â”œâ”€â”€ ç¯æ¯”: +3.5%
â””â”€â”€ é¢„æµ‹ä¸‹æœˆ: $1,456.00 (å¯èƒ½è¶…é¢„ç®—)
```

---

## ğŸ“Š æˆæœ¬åˆ†æç¤ºä¾‹

### 1. æŒ‰æ¨¡å‹æˆæœ¬å¯¹æ¯”

| æ¨¡å‹ | è¯·æ±‚æ•° | Token | æˆæœ¬ | å æ¯” |
|------|--------|-------|------|------|
| GPT-4 | 1,000 | 3M | $90.00 | 60% |
| Claude-3-Sonnet | 2,000 | 4M | $30.00 | 20% |
| Gemini-Pro | 5,000 | 10M | $15.00 | 10% |
| GPT-3.5-Turbo | 3,000 | 9M | $15.00 | 10% |

### 2. æŒ‰ç”¨æˆ·æˆæœ¬åˆ†è§£

| ç”¨æˆ· | è¯·æ±‚æ•° | æˆæœ¬ | å æ¯” |
|------|--------|------|------|
| user-001 | 3,000 | $45.00 | 30% |
| user-002 | 2,500 | $37.50 | 25% |
| user-003 | 2,000 | $30.00 | 20% |
| å…¶ä»– | 2,500 | $37.50 | 25% |

### 3. è¶‹åŠ¿åˆ†æ

```
è¿‡å»30å¤©æˆæœ¬è¶‹åŠ¿:
$50 â”¤     â•­â”€â•®
    â”‚   â•­â”€â•¯ â•°â”€â•®
$40 â”¤ â•­â”€â•¯     â•°â”€â•®
    â”‚â•­â•¯         â•°â”€â•®
$30 â”¼â•¯            â•°
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    1   10  20  30å¤©

è¶‹åŠ¿: é€’å¢ (+12.5%/æœˆ)
é¢„æµ‹: ä¸‹æœˆå°†è¾¾åˆ° $55.00
å»ºè®®: å¯ç”¨ç¼“å­˜ä¼˜åŒ–
```

---

## ğŸ”§ ä½¿ç”¨ç¤ºä¾‹

### 1. è®°å½•Tokenä½¿ç”¨

```go
import "github.com/agent-learning/enterprise-platform/services/cost/internal/calculator"

// åˆ›å»ºè®¡ç®—å™¨
calc := calculator.NewCostCalculator()

// è®¡ç®—æˆæœ¬
usage, err := calc.Calculate("gpt-4", 1000, 2000)
// usage.TotalCost = $0.15 (è¾“å…¥$0.03 + è¾“å‡º$0.12)

// ä¿å­˜åˆ°æ•°æ®åº“
usage.TenantID = "tenant-001"
usage.UserID = "user-001"
usage.AgentID = "agent-123"
repo.CreateTokenUsage(ctx, usage)
```

### 2. æˆæœ¬é¢„æµ‹

```go
import "github.com/agent-learning/enterprise-platform/services/cost/internal/forecaster"

// åˆ›å»ºé¢„æµ‹å™¨
forecaster := forecaster.NewForecaster(repo)

// é¢„æµ‹ä¸‹æœˆæˆæœ¬
forecast, err := forecaster.ForecastNextMonth(ctx, tenantID)
// forecast.PredictedCost = $150.00
// forecast.Confidence = 0.85
```

### 3. æ£€æŸ¥å‘Šè­¦

```go
import "github.com/agent-learning/enterprise-platform/services/cost/internal/alerter"

// åˆ›å»ºå‘Šè­¦å™¨
alerter := alerter.NewAlerter(repo)

// æ£€æŸ¥é¢„ç®—å‘Šè­¦
alerts, err := alerter.CheckBudgetAlerts(ctx, tenantID)
for _, alert := range alerts {
    if alert.Severity == "critical" {
        // å‘é€ç´§æ€¥é€šçŸ¥
        alerter.SendNotification(ctx, alert, []string{"email", "sms"})
    }
}
```

### 4. è·å–ä¼˜åŒ–å»ºè®®

```go
// ç”Ÿæˆä¼˜åŒ–å»ºè®®
recommendations := calc.OptimizationRecommendations(
    "gpt-4",           // å½“å‰æ¨¡å‹
    5000000,           // æ€»Token
    10000,             // æ€»è¯·æ±‚æ•°
    1000.00,           // å½“å‰æˆæœ¬
    35.0,              // ç¼“å­˜å‘½ä¸­ç‡
)

for _, rec := range recommendations {
    fmt.Printf("å»ºè®®: %s\n", rec.Title)
    fmt.Printf("èŠ‚çœ: $%.2f (%.1f%%)\n", rec.Savings, rec.SavingsPercent)
    fmt.Printf("ä¼˜å…ˆçº§: %s\n", rec.Priority)
}
```

---

## ğŸš€ ä¸‹ä¸€æ­¥

**Task 4.1.5 - å®ç°æ€§èƒ½ä¼˜åŒ–ï¼ˆDay 12-14ï¼‰**:
- æµå¼å“åº”ï¼ˆServer-Sent Eventsï¼‰
- å¼‚æ­¥å¤„ç†ï¼ˆä»»åŠ¡é˜Ÿåˆ—ï¼‰
- è¯·æ±‚åˆå¹¶ï¼ˆæ‰¹å¤„ç†ï¼‰
- Promptå‹ç¼©ï¼ˆå‡å°‘Tokenï¼‰
- ä¸Šä¸‹æ–‡çª—å£ç®¡ç†
- è¿æ¥æ± ä¼˜åŒ–
- è‡ªåŠ¨æ‰©ç¼©å®¹é…ç½®

**Task 4.1.6 - å®ç°ç›‘æ§ç³»ç»Ÿï¼ˆDay 15-17ï¼‰**:
- PrometheusæŒ‡æ ‡é›†æˆ
- Grafanaé¢æ¿é…ç½®
- å‘Šè­¦è§„åˆ™å®šä¹‰
- æœåŠ¡å¥åº·æ£€æŸ¥

---

## ğŸ“ æ–‡ä»¶æ¸…å•

```
services/cost/
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â””â”€â”€ cost.go                       âœ… æˆæœ¬æ¨¡å‹ï¼ˆ300è¡Œï¼‰
â”‚   â”œâ”€â”€ calculator/
â”‚   â”‚   â””â”€â”€ cost_calculator.go            âœ… æˆæœ¬è®¡ç®—å™¨ï¼ˆ250è¡Œï¼‰
â”‚   â”œâ”€â”€ forecaster/
â”‚   â”‚   â””â”€â”€ forecaster.go                 âœ… æˆæœ¬é¢„æµ‹å™¨ï¼ˆ200è¡Œï¼‰
â”‚   â””â”€â”€ alerter/
â”‚       â””â”€â”€ alerter.go                    âœ… æˆæœ¬å‘Šè­¦å™¨ï¼ˆ220è¡Œï¼‰
â”œâ”€â”€ migrations/
â”‚   â””â”€â”€ 001_initial.up.sql                âœ… æ•°æ®åº“è¿ç§»ï¼ˆ200è¡Œï¼‰
â””â”€â”€ README.md                              ğŸ“ å¾…æ·»åŠ 
```

**æ€»ä»£ç é‡**: ~1,170è¡Œ

---

**ç‰ˆæœ¬**: v1.0.0
**çŠ¶æ€**: âœ… Task 4.1.4 å®Œæˆ
**è¾“å‡º**: æˆæœ¬æ§åˆ¶ç³»ç»Ÿã€Tokenç›‘æ§ã€æˆæœ¬é¢„æµ‹ã€æˆæœ¬å‘Šè­¦

## ğŸ‰ Task 4.1.4 æˆæœ¬æ§åˆ¶å®ç°å®Œæˆï¼

å®ç°äº†å®Œæ•´çš„æˆæœ¬æ§åˆ¶å’Œç›‘æ§ç³»ç»Ÿï¼š
- âœ… 11ç§LLMæ¨¡å‹å®šä»·æ”¯æŒ
- âœ… å®æ—¶Tokenä½¿ç”¨è¿½è¸ª
- âœ… æˆæœ¬è®¡ç®—å™¨
- âœ… 3ç§é¢„æµ‹ç®—æ³•ï¼ˆçº¿æ€§å›å½’/æŒ‡æ•°å¹³æ»‘/å¼‚å¸¸æ£€æµ‹ï¼‰
- âœ… 4ç±»ä¼˜åŒ–å»ºè®®ï¼ˆæ¨¡å‹/ç¼“å­˜/æ‰¹é‡/Promptï¼‰
- âœ… å¤šçº§å‘Šè­¦ç³»ç»Ÿï¼ˆé¢„ç®—/é¢„æµ‹/å¼‚å¸¸/é€Ÿç‡ï¼‰
- âœ… æ—¶åºæ•°æ®å­˜å‚¨
- âœ… æˆæœ¬æŠ¥è¡¨å’Œåˆ†æ

**ä»æ— åˆ°æœ‰æ„å»ºä¼ä¸šçº§æˆæœ¬æ§åˆ¶å¹³å°ï¼**
